## 6 集群成员变化

### 集群配置转换

在集群配置的转换过程中，可能存在划分成两个独立的大多数群体的可能性。

解决：配置更改必须两阶段。第一阶段中，新老配置要达成共同一致。

领导人在接收到配置更改请求后，配置会存在一个过渡状态“Cold,new”，直到Cnew被提交

![](../images/raft-图11.png)

图中，虚线表示创建未提交，实现表示被提交。

### 新服务器加入

新加入的服务器由于没有存储任何日志条目，且拥有投票权，会导致此时不能提交新的日志条目，即一种可用性的时间间隔。

解决：提供额外的阶段，新的服务器在追赶上日志之前，没有投票权。

### 领导人不是新配置的一员

没懂

### 移除不在Cnew中的服务器可能会扰乱集群

## 7 日志压缩

快照：在某个时间点，整个系统的状态写入稳定的持久化存储，然后丢弃之前的日志。

![](../images/raft-图12.png)

服务器一般独立创建快照，除了落后的跟随者。

领导者发送安装快照RPC给跟随者

## 8 客户端交互

### 客户端通信过程

1. 客户端随机挑选一个服务器发送请求
2. （服务器不是领导人）服务器拒绝请求，将领导人信息返回
3. 若领导人崩溃，则客户端请求超时；客户端之后重新随机挑选服务器发送请求。

## 9 算法实现和评估

### 性能关注点

- 当领导人被选举成功时，什么时候复制新的日志条目
- 在领导人宕机之后，最小的系统宕机时间是多久

## 10 相关工作

前文第5节已详述了Raft的特点，此处主要是和其他几个算法的对比。

Raft 和 Paxos 最大的不同：Raft使用领导人选举，领导人承担了更多的工作。Raft的领导人选举是一致性的要求，而Paxos没有这一要求。Ra

VR 和 ZooKeeper：Raft非领导人的功能少。Raft中日志条目是领导人向跟随者单向传递，VR中为双向；ZK为止，公开资料显示为双向。

消息类型：Raft只有4种（2种RPC请求和相应的响应）；VR和ZK都分别有10种。Raft的消息信息量大，但是简单。

Raft排斥性能优化：平等主义Paxos（EPaxos）可以在没有领导人的情况下性能高，负载均衡能力强，但是增加复杂性。

## 11 结论

作者认为可理解性很重要



























