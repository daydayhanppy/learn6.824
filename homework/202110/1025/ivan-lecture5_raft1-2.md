# 6 Raft

## 6.1 脑裂（Split-brain）

MapReduce、GFS、VMware FT 都存在一个主机，这种方式可以避免脑裂，但同样是一个单点故障的隐患。

方法：客户端总是要等待两个服务器响应，如果只有一个服务器响应，永远不要执行任何操作

## 6.2 过半票决（Majority Vote）

1. 服务器的数量是奇数，能使过半票决通过

过半的分母：所有服务器，而不是当前开机服务器

**如果系统有 2 \* F + 1 个服务器，那么系统最多可以接受F个服务器出现故障，仍然可以正常工作。**

## 6.3 Raft 初探

上层：应用程序代码，接收RPC或者其他客户端请求。Lab3 中即为 KV 数据库。上层KV数据库向Raft层进行函数调用，以传递状态。

下层：Raft库，帮助应用程序将其状态拷贝到其他副本节点。lab3 中即为 KV table。Raft本身也有状态，需要记录操作日志。

客户端：外部程序代码，使用服务，分布式对其透明。

**客户端步骤**

1. 客户端发送请求（get/put）给 leader 节点
2. leader 节点的上层将请求发送到Raft层
3. Raft层将操作提交到log中，并在节点间交互
4. 过半的节点将操作添加到日志，并通知了 leader 节点
5. leader 节点的 Raft 层发送通知给应用程序
6. 应用程序执行操作



