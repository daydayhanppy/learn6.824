# The Google File System

## 1 简介

- 组件失效为常态事件：需要持续监控、错误侦测、灾难冗余、自动恢复机制
- 文件巨大：需要重新设计 IO 操作和 Block 大小
- 写数据特点：写入一般为尾部追加，少有随机写入。需要考虑数据追加的性能优化、原子性保证

## 2 设计概述

### 2.1 设计预期

- 系统工作负载：大规模的流式读取、小规模的随机读取；大规模顺序写入、小规模随机写入
- 多客户端并行写数据到同一文件：使用最小的同步开销
- 网络：高性能的稳定带宽 > 低延迟

### 2.2 接口

- 支持 CRUD
- 快照功能：低成本创建拷贝
- 生产者-消费者队列：多客户端并行追加写同一个文件

### 2.3 架构

- 一个 Master 节点（Master 节点为逻辑概念，包括两台物理主机），多台 Chunk 服务器
- 文件分割为固定大小的 Chunk，Chunk 拥有唯一标识
- Chunk 服务器将 Chunk 以 Linux 文件的形式存储在本地，每个 Chunk 存储 3 份
- Master 节点管理元数据：文件和 Chunk 映射关系、访问控制信息等
- Master 节点管理活动：Chunk 租用管理、孤儿 Chunk 回收、和 Chunk 服务器的心跳沟通

![figure1](../images/image-20210928203518789.png)

### 2.6 元数据

元数据都保存在 Master 服务器的内存

- 文件和 Chunk 的命名空间
- 文件和 Chunk 的对应关系
- 每个 Chunk 副本的存放位置

### 2.7 一致性保障

- 命名空间锁（4.1）
- Master 节点的操作日志：元数据变更历史记录

## 3 系统交互